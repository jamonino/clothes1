<br />
<div align="center">
  
  <h1 align="center">CLOTHES</h3>

  <p align="left">
    La valoración total del examen es de <b>10 puntos</b>.
    <br />
    <br />
    Se puede emplear Base de Datos o hacerlo con variables internas de Java sin persistencia de datos.
    <br />
    <br />
    Si se opta por hacerlo sin persistencia de datos, se pierde <b>1 punto</b> del examen.
    <br />
    <br />
    Lenguaje: Java
    ·
    Motor BBDD: PostgreSQL
  </p>
</div>

    
## RESUMEN CON VALORACIONES:   
Crear la API REST/JSON de una web de comercio electrónico para venta de ropa llamada "Clothes"

* Limpieza y estructura de código **1P**

* Uso de BBDD **1P**

### RECURSOS A DESARROLLAR

**clothes/admin**
    
* POST - Crear producto       **2P**
    
* GET - Lista completa    **1P**
    
* PUT - Editar producto       **2P** (Control de nulos para poder editar únicamente algunos campos **1P**)

**clothes/user**

* POST - POST - Simula una compra de un producto y resta stock del mismo (si no hay stock suficiente devuelve responseCode -1) **2P**

**clothes/user/{gender}**

* GET - Lista con al menos un elemento en stock del género aportado en la ruta **1P**

## BBDD

Para crear la BBDD necesaria ejecutar con ssh los siguientes comandos (no os preocupéis si da algún error de permisos, simplemente seguid con el siguiente comando):

```sh
sudo su postgres
```
Creamos el usuario
```sh
createuser clothes_user
```
Creamos la BBDD asignando como dueño al usuario creado 
```sh
createdb clothes_db --owner clothes_user
```
Entramos en consola SQL genérica
```sh
psql
```
Cambiamos la contraseña del usuario
```sh
alter user clothes_user with password '12345';
```
Salimos de consola SQL genérica
```sh
\q
```
Entramos en consola SQL de la BBDD creada
```sh
psql clothes_db
```

Ahora copiar y pegar el siguiente código completo

```sql

DROP TABLE IF EXISTS products CASCADE;
CREATE TABLE products (
"id" integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" character varying(100),
"price" integer,
"stock" integer,
"gender" integer
);

REVOKE ALL ON SCHEMA public FROM PUBLIC;
GRANT ALL ON SCHEMA public TO clothes_user;

REVOKE ALL ON products FROM public;
GRANT ALL ON products TO clothes_user;

INSERT INTO products (name, price, stock, gender) VALUES ('pantalones', 2000, 6, 1);
INSERT INTO products (name, price, stock, gender) VALUES ('camiseta', 2200, 4, 1);
INSERT INTO products (name, price, stock, gender) VALUES ('chaqueta', 1000, 1, 1);
INSERT INTO products (name, price, stock, gender) VALUES ('camisa', 3300, 7, 1);
INSERT INTO products (name, price, stock, gender) VALUES ('calcetines', 500, 0, 1);
INSERT INTO products (name, price, stock, gender) VALUES ('blusa', 1800, 1, 2);
INSERT INTO products (name, price, stock, gender) VALUES ('vestido', 4500, 4, 2);
INSERT INTO products (name, price, stock, gender) VALUES ('falda', 3000, 2, 2);
INSERT INTO products (name, price, stock, gender) VALUES ('medias', 1000, 0, 2);
INSERT INTO products (name, price, stock, gender) VALUES ('zapatos de tacón', 3400, 3, 2);

```
Para asegurar que se han creado las tablas e insertado los datos, se puede ejecutar la siguiente sentencia:

```sql
SELECT * FROM products;
```
Y nos debe devolver algo así
```
 id |       name       | price | stock | gender
----+------------------+-------+-------+--------
  1 | pantalones       |  2000 |     6 |      1
  2 | camiseta         |  2200 |     4 |      1
  3 | chaqueta         |  1000 |     1 |      1
  4 | camisa           |  3300 |     7 |      1
  5 | calcetines       |   500 |     0 |      1
  6 | blusa            |  1800 |     1 |      2
  7 | vestido          |  4500 |     4 |      2
  8 | falda            |  3000 |     2 |      2
  9 | medias           |  1000 |     0 |      2
 10 | zapatos de tacón |  3400 |     3 |      2
(10 rows)
```

Ahora ya puedes empezar a programar. En este repositorio tienes el proyecto iniciado con el archivo POM definitivo por si quieres ahorrar tiempo.

## RECURSOS

En todos los recursos, en caso de excepción se debe devolver un objeto Response con responseCode = 0.

### clothes/admin

* **POST** - Inserta un producto en el catálogo de productos      **2P**

Consume un JSON de un producto completo y produce un JSON del objeto Response con responseCode=1.

--> REQUEST 
```js
{
  "name":"corbata",
  "price":2900,
  "stock":8,
  "gender":1
}
```
<-- RESPONSE
```js
{
  "responseCode":1
}
```

* **GET** - Lista completa de productos con stock, precio y género de cada uno   **1P**

No consume nada y produce un JSON del objeto Response con responseCode = 1 y la lista completa de productos del cátalogo.

<-- RESPONSE
```js
{
  "responseCode":1,
  "products":[
    {
      "id":1,
      "name":"corbata",
      "price":2900,
      "stock":8,
      "gender":1
    },
    {
      "id":2,
      "name":"bufanda",
      "price":1200,
      "stock":4,
      "gender":2
    }
  ]
}
```

* **PUT** - Editar producto       **2P** (De esos 2 puntos, **1P** corresponde a si se añade la posibilidad de editar únicamente algunos campos)

Consume un JSON de un producto y produce un JSON del objeto Response con responseCode=1.

--> REQUEST editando todo el producto
```js
{
  "id":4,
  "name":"corbata",
  "price":2900,
  "stock":8,
  "gender":1
}
```
--> REQUEST editando parte del producto
```js
{
  "id":4,
  "price":1900,
  "stock":8
}
```
<-- RESPONSE
```js
{
  "responseCode":1
}
```

### clothes/user

* POST - Simula una compra de un producto y resta stock del mismo (si no hay stock suficiente devuelve responseCode -1) **2P** (De los 2 puntos, 1 punto consiste en la posibilidad de especificar la cantidad que se compra. Si se opta por no especificar la cantidad, simplemente se resta un producto si el stock es distinto de 0)

Consume un JSON de un producto y produce un JSON del objeto Response con responseCode = 1 o -1 dependiendo de si ha podido restar la cantidad comprada al stock (1) o no quedaba stock suficiente y no resta nada (-1).

```js
{
  "id":4,
  "quantity":2
}
```
<-- RESPONSE
```js
{
  "responseCode":1 / -1
}
```

**clothes/user/{gender}**

* GET - Lista los productos con al menos un elemento en stock del género aportado en la ruta **1P**

Por parámetro de ruta se pasa el género por el que queremos filtrar. Produce un objeto Response con responseCode = 1 y una lista de productos con el género especificado y con al menos un elemento en stock.

<-- RESPONSE
```js
{
  "responseCode":1,
  "products":[
    {
      "id":1,
      "name":"corbata",
      "price":2900,
      "stock":8,
      "gender":1
    },
    {
      "id":2,
      "name":"bufanda",
      "price":1200,
      "stock":4,
      "gender":1
    }
  ]
}
```

<br />
<div align="center">
  <h1 align="center">¡Mucho ánimo!</h3>
</div>




